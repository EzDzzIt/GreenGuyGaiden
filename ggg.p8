pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
--main engine functions

function _init()
	cls(0)
--define player data
	player_x, player_y, xsp, ysp = 64,64,0,0
	player_spr, player_dir = 1, false
	jmp = false
--cooldown set, height set, starting cd
	jmpclim, jmplim, jmpcool = 8, 0, 0
--special character states to check	
	grnd, dead = true,false
--counter
	t = 0
end

function _update60()
	--you fell into a pit
	if player_y >= 128 then
		dead = true
	end
	
	--debugging ground
	if player_y >= 100 then
		player_y = 100
		grnd = true
	end
	
	move_player()
	animate_player()
	
	
	--t is my counter, dude
	t = t + 1
	if (t == 60) then
		t = 0
	end
	
function _draw()
	cls(12)
	spr(player_spr,player_x,player_y,1,1,player_dir)
	--debug vars
	debug()
end

end
-->8
--player movement and input
function move_player()

	if btn(1) then --➡️ wins!
		xsp = 1
	--	if btn(1) then
	--		xsp = 0
	--	end
	elseif btn(0) then
			xsp = -1
	else
			xsp = 0
	end

--check direction/flip of sprite
	if xsp > 0 then
		player_dir = false
	elseif xsp < 0 then
		player_dir = true
	end
	
--move x
player_x = player_x + xsp

--gravity
if grnd then
	ysp = 0
else
	--accel limit?
	if t%5 == 0 then
		if ysp < 5 then
			ysp = ysp + 1
		end
	end
end

--jump logic
--cooldown on the ground
if jmpcool > 0 and grnd then
	jmpcool = jmpcool - 1
	jmp = false
end
--first time button pressed
if(btn(4)) and grnd and jmpcool == 0 then
	if jmp == false then
		jmpcool = jmpclim
		sound()
	end
	ysp = -2
	jmp = true
	grnd = false
	jmplim = 0
end
--holding down the jmp button in air
if jmp and btn(4) and jmplim < 10 then
	ysp = -2
	jmplim += 1
else
--no double jumping
	jmplim = 99
end

--move y
player_y = player_y + ysp

end
-->8
--animation
function animate_player()
--animation state machine:
--state 0: idle
	if xsp == 0 and ysp == 0 and jmpcool == 0 then
		player_spr = 1
--state 1: walking on flat grnd
	elseif xsp != 0 and grnd and jmpcool == 0 then
	--ani speed
		if t%8 == 0 then
			player_spr += 1
			--clamp animation
			if player_spr > 3 then
				player_spr = 1
			end
		end
--state 2: jmping up
	elseif jmp and ysp < 0 then
		player_spr = 4
--state 3: falling
	elseif jmp and ysp > 0 then
		player_spr = 5
--state 4: jmp recovery
	elseif grnd and jmpcool > 0 then
		player_spr = 6
	end
end
-->8
--debug
function debug()
	print(player_x)
	print(player_y)
	print("grnd = " ..tostr(grnd))
	print("jmp = " ..tostr(jmp))
	print("jmplim = " ..tostr(jmplim))
	print("jmpcool = " ..tostr(jmpcool))
end
-->8
--soundfx
function sound()
	sfx(0)
end
__gfx__
00000000c9c333ccc9c333ccc9c333ccc9c333ccc9c333ccccccccccffccccffcccccccc55555555000000000000000000000000000000000000000000000000
06000060c89bb33cc89bb33cc89bb33cc897373cc89bbb33c9c333ccfccccfffcccccccc05050500000000000000000000000000000000000000000000000000
00700700c3bb7b7cc3bb7b7cc3bb7b7cc3b7777c3bb7777bc89bb3ccccccffffcccccccc5c5c5ff5000000000000000000000000000000000000000000000000
600770063bb7373c3bb7373c3bb7373c3bb7777c33b7373bc3b7773ccccfffffcccccccccccfffff000000000000000000000000000000000000000000000000
060770603bbb7b733b3b7b7b3b3b7b73bb3b33b3c3bbbbb33bb7377cccfffffcccccccccccfffffc000000000000000000000000000000000000000000000000
007007003b3bb3b33bb3b3b33bb3b3b3333bbbb3cc3b33b33bbbbbb3cfffffcccccccccccfffffcc000000000000000000000000000000000000000000000000
00000000c3bbbb3cc33bbbb6633bbbbcc36bb6b3c6bbbbb63b3bb3b3fffffcccccccccccfffffccc000000000000000000000000000000000000000000000000
0000000066333366c663336cc633336cc663366ccc63366cc36bb63cffffccccccccccccffffcccc000000000000000000000000000000000000000000000000
__map__
0808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808010808080808070707070707070700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909070707070707070700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707070707070700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
60010000015500655006550065500655007550075500755007550095500a5500d550115501455017550195501b5501c5501c5501b550195501755014550117500e7500c7500a7500875007750067500475004750
